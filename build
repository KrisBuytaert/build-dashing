#!/bin/bash
set -x

if [ -z ${http_proxy+x} ]; then
    docker_cmd=docker
else
    docker_cmd="docker -e http_proxy=$http_proxy"
fi
rm -rf package-scripts/*.rpm 
cd centos
$docker_cmd build -t dashing/centos7 .
cd ..

cd rvm
$docker_cmd build -t dashing/rvm .
cd ..

$docker_cmd run -v=`pwd`/package-scripts:/scripts dashing/rvm  /scripts/packagervm

cd ruby21
$docker_cmd build -t dashing/ruby21 .
cd ..

$docker_cmd run -v=`pwd`/package-scripts:/scripts dashing/ruby21  /scripts/packageruby

cd dashing
$docker_cmd build -t dashing/dashing .
cd ..

$docker_cmd run -v=`pwd`/package-scripts:/scripts dashing/dashing  /scripts/packagedashing

$docker_cmd run -v=`pwd`/package-scripts:/scripts  -v=`pwd`/dashboards:/dashboards dashing/dashing  /scripts/packagedashboard
